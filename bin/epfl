import argparse
import logging
logging.basicConfig(level=logging.WARN)
from functools import partial

from epflmanager.commands.site import Site
from epflmanager.commands.horaire import Horaire
from epflmanager.commands.courses import Courses
from epflmanager.commands.open import Open

from epflmanager.io import ConsoleManager

manager = ConsoleManager()

siteFunc    = partial(Site.run, manager=manager)
openFunc    = partial(Open.run, manager=manager)
coursesFunc = partial(Courses.run, manager=manager)

parser = argparse.ArgumentParser(description='Manage EPFL courses')

subparsers = parser.add_subparsers()
site_parser = subparsers.add_parser("site", aliases=["s"])
site_parser.add_argument("course")
site_parser.set_defaults(func=siteFunc)

open_parser = subparsers.add_parser("open", aliases=["o"])
open_parser.add_argument("course")
open_parser.add_argument("target", default="site", nargs="?")
open_parser.set_defaults(func=openFunc)

horaire = subparsers.add_parser("horaire", aliases=["h"])
horaire.set_defaults(func=Horaire.run)

courses = subparsers.add_parser("courses")
courses.set_defaults(func=coursesFunc)

parser.set_defaults(func=coursesFunc)

args = parser.parse_args()
args.func(args)
