import argparse
import logging
logging.basicConfig(level=logging.WARN)

from epflmanager.commands.site import Site
from epflmanager.commands.horaire import Horaire
from epflmanager.commands.courses import Courses
from epflmanager.commands.open import Open
import epflmanager.config as config
from epflmanager.io import ConsoleManager, CourseHandler, SemesterNotFound
from epflmanager.config import Config
import epflmanager.components as components

EPFL_DIR = "/Users/cranium/Documents/EPFL/"
SEMESTER_VALID_DIRS = ["BA", "MA"]

ConsoleManager() # Create the console component
CourseHandler()  # Create the file&directory handler
config.add("EPFL_DIR", EPFL_DIR)
config.add("SEMESTER_VALID_DIRS", SEMESTER_VALID_DIRS)

parser = argparse.ArgumentParser(description='Manage EPFL courses')

subparsers = parser.add_subparsers()
site_parser = subparsers.add_parser("site", aliases=["s"])
site_parser.add_argument("course")
site_parser.set_defaults(func=Site.run)

open_parser = subparsers.add_parser("open", aliases=["o"])
open_parser.add_argument("course")
open_parser.add_argument("target", default="site", nargs="?")
open_parser.set_defaults(func=Open.run)

horaire = subparsers.add_parser("horaire", aliases=["h"])
horaire.set_defaults(func=Horaire.run)

courses = subparsers.add_parser("courses")
courses.set_defaults(func=Courses.run)

parser.set_defaults(func=Courses.run)

try:
    args = parser.parse_args()
    args.func(args)
except SemesterNotFound:
    components.get("Console").error("Semester not found")
